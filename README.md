# 《Prompt Jumper / 伪人攀登》开发文档

## 文档基础信息

|   项⽬   |                             内容                             |
| :------: | :----------------------------------------------------------: |
| 游戏名称 |              Prompt Jumper / 伪人攀登（暂定名）              |
| 引擎版本 |                          团结1.6.5                           |
| 开发目标 | 完成 Global Game Jam（GGJ）周期内的核心玩法落地，适配策划案核心逻辑 |
| 文档目的 | 统一开发规范、明确模块分工、梳理实现优先级、指导代码编写与版本管理 |

## 一、项目文件树（Unity 规范）

```plain txt
Assets/
├── Scenes/                  // 场景文件
│   ├── MainMenu.unity       // 主菜单场景（初始通知列表）
│   ├── Level1.unity         // 第一关场景
│   ├── Level2.unity         // 第二关场景
│   └── GameOver.unity       // 游戏结束场景
├── Scripts/                 // 核心脚本目录
│   ├── Player/              // 玩家相关脚本
│   │   ├── PlayerController.cs   // 角色移动/跳跃/物理核心
│   │   ├── MaskManager.cs        // 面具A/B/C的逻辑管理
│   │   └── PlayerState.cs        // 玩家状态（快乐值/冷却/安全位置）
│   ├── Camera/              // 摄像头相关脚本
│   │   └── CameraController.cs   // 动态调速/区域判定/平滑插值
│   ├── Bubble/              // 气泡相关脚本
│   │   ├── BubbleGenerator.cs    // 气泡生成/显隐/预生成逻辑
│   │   ├── SelfBubble.cs         // 玩家面具气泡（A/B）的物理/生命周期
│   │   └── EnemyBubble.cs        // 敌对气泡（Block/Trap/Missile/Ghost）逻辑
│   ├── Item/                // 道具相关脚本
│   │   ├── ItemManager.cs        // 道具拾取/Buff管理
│   │   └── ItemPickup.cs         // 单个道具的触发/效果逻辑
│   ├── UI/                  // UI相关脚本
│   │   ├── UIManager.cs          // 快乐值/限制槽/通关UI管理
│   │   └── UIFeedback.cs         // 气泡弹出动画/技能反馈
│   └── Core/                // 全局核心脚本
│       ├── GameManager.cs        // 全局流程（通关/死亡/关卡切换）
│       ├── ObjectPool.cs         // 气泡对象池管理
│       └── BugFixHandler.cs      // Mask C卡墙/气泡重叠修复逻辑
├── Prefabs/                 // 预制体
│   ├── Player/              // 玩家预制体
│   ├── Bubbles/             // 气泡预制体（A/B/Block/Trap/Missile/Ghost）
│   ├── Items/               // 道具预制体（咖啡/酒精/充电宝/撤回消息）
│   └── UI/                  // UI预制体（快乐值条/限制槽/发送按钮）
├── Resources/              // 资源目录
│   ├── Audio/               // 音效（打字声/发送声/技能声）
│   ├── Sprites/             // 精灵（气泡/角色/道具/UI）
│   └── Text/                // 气泡文本配置（如“好的”“方案重做”）
├── Materials/               // 材质（极简UI风格/半透明Mask C）
└── Editor/                  // 编辑器扩展（可选，GGJ优先级低）
```

## 二、核心模块讲解

### 1. 玩家核心模块

#### 核心逻辑

- 角色基础操控：A/D 移动、Space 跳跃，通过`Rigidbody2D`实现 2D 物理移动；
- 面具系统：Mask A（铺路）、Mask B（弹射）、Mask C（无敌穿墙）的触发 / 冷却 / 数值消耗；
- 状态管理：快乐值（0-100）的增减、Mask 冷却时间、安全位置记录（解决 Mask C 卡墙）。

#### 关键实现点

- Mask A 使用`Queue`限制同时存在 3 个，超出则销毁最旧的；
- Mask B 通过计时器限制冷却（1.5 秒），弹射时给`Rigidbody2D`施加瞬时力；
- Mask C 通过`Layer Collision Matrix`关闭碰撞，结束前检测重叠并推离敌对气泡。

### 2. 摄像头动态调速模块

#### 核心逻辑

- 垂直区域三等分（底部安全区 / 中间目标区 / 顶部压迫区），根据玩家位置调整速度；
- 速度平滑插值（Lerp）过渡（0.2 秒），避免突变；
- 极端情况处理：底部裁剪线暂停 1 秒、顶部压迫区 5 秒锁定最大速度。

#### 关键实现点

- 摄像头速度阈值：最小 0.5 单位 / 秒、基准 1.0、最大 1.8（关卡后期可全局 + 20%-30%）；
- 预生成预警距离随速度适配（5→8 个身位），临时救场气泡阈值同步上调。

### 3. 气泡生成与显隐模块

#### 核心逻辑

- 所有气泡在激活线上方 0.1 单位隐藏生成，触线时完整显示（恢复渲染 / 缩放 / 透明度）；
- 敌对气泡触线后启动物理逻辑（如 Block 下落），玩家气泡即时显示；
- 防空窗兜底：分层预生成、临时救场气泡、对象池管理。

#### 关键实现点

- 显隐触发时附加 0.1 秒微放大动画（1.2→1 倍），强化 “消息弹出” 感；
- 玩家气泡渲染层级置顶（sortingOrder=20），覆盖敌对气泡避免误触。

### 4. 敌对单位模块

#### 核心逻辑

- 敌对气泡分为 Block（压迫块）、Trap（情绪刺）、Missile（夺命 Call）、Ghost（冷暴力）；
- 不同类型对应不同物理规则（如 Trap 触碰扣血、Ghost 站 0.5 秒碎裂）；
- 与玩家气泡的交互：玩家踩自身气泡时，无视敌对气泡碰撞。

#### 关键实现点

- Missile 通过`Transform.LookAt`+ 刚体速度追踪玩家；
- Ghost 通过计时器检测玩家停留时间，到点销毁 / 失活。

### 5. 道具系统模块

#### 核心逻辑

- 道具拾取后触发临时 Buff，打破基础规则限制（如咖啡让 Mask A 免消耗）；
- 道具放置逻辑：咖啡在精密跳跃段前、酒精在大跨度段前、充电宝在必死机关前。

#### 关键实现点

- `BuffManager`通过协程控制 Buff 持续时间，拾取后标记状态，到期重置；
- 撤回消息为收集品，仅记录数量，通关后解锁剧情。

### 6. UI 与全局流程模块

#### 核心逻辑

- UI 模拟手机聊天界面，显示快乐值（红绿渐变条）、限制槽（角色头顶...）；
- 全局流程：主屏幕→关卡→结算→下一关（触发 [发送] 按钮切换）；
- 死亡判定：快乐值归零 / 掉落摄像头下方，显示 “你已崩溃 / 退群”。

## 三、实现优先级（适配 GGJ 开发节奏）

### P0（必须实现，核心玩法兜底）

| 优先级 |         功能模块          |             对应脚本             |             核心目标             | 预估耗时（人 / 小时） |
| :----: | :-----------------------: | :------------------------------: | :------------------------------: | :-------------------: |
|   P0   |       角色基础操控        |       PlayerController.cs        |  A/D 移动、Space 跳跃、物理落地  |           1           |
|   P0   |   Mask A/B 生成基础逻辑   |  MaskManager.cs、SelfBubble.cs   | 左键 / Q 生成 A、右键 / E 生成 B |          1.5          |
|   P0   |      摄像头基础调速       |       CameraController.cs        | 区域判定、最小 / 基准 / 最大速度 |           1           |
|   P0   |    气泡基础生成 / 显隐    |        BubbleGenerator.cs        |      激活线触显、无半个气泡      |           1           |
|   P0   |         死亡判定          |  PlayerState.cs、GameManager.cs  |   掉落摄像头下 / 快乐值归零 GG   |          0.5          |
|   P0   | Mask C 核心逻辑（防卡墙） | MaskManager.cs、BugFixHandler.cs |     无敌穿墙、结束前推离重叠     |           1           |
|   P0   |     基础 UI（快乐值）     |           UIManager.cs           |     显示快乐值增减、死亡提示     |          0.5          |
|   P0   |         通关判定          |          GameManager.cs          |   触碰 [发送] 按钮触发关卡结算   |          0.5          |

### P1（核心玩法强化，体验完整）

| 优先级 |         功能模块          |          对应脚本           |             核心目标             | 预估耗时（人 / 小时） |
| :----: | :-----------------------: | :-------------------------: | :------------------------------: | :-------------------: |
|   P1   |     敌对气泡基础逻辑      |       EnemyBubble.cs        |    Block 下落、Trap 触碰扣血     |          1.5          |
|   P1   |      快乐值数值逻辑       |       PlayerState.cs        |     Mask A 扣血、Mask B 回血     |          0.5          |
|   P1   |   Mask 冷却 / 数量限制    |       MaskManager.cs        | Mask A 限 3 个、Mask B 冷却 1.5s |           1           |
|   P1   | 摄像头平滑插值 / 极端限制 |     CameraController.cs     |    0.2 秒调速、底部暂停 1 秒     |          0.5          |
|   P1   |     聊天 UI 基础搭建      | UIManager.cs、UIFeedback.cs |    模拟聊天界面、气泡弹出动画    |           1           |
|   P1   |      对象池基础管理       |        ObjectPool.cs        | 复用气泡，避免 Instantiate 卡顿  |           1           |

### P2（锦上添花，提升体验）

| 优先级 |     功能模块      |           对应脚本            |         核心目标          | 预估耗时（人 / 小时） |
| :----: | :---------------: | :---------------------------: | :-----------------------: | :-------------------: |
|   P2   |     道具系统      | ItemManager.cs、ItemPickup.cs | 咖啡 / 酒精 / 充电宝 Buff |           2           |
|   P2   |  敌对气泡进阶 AI  |        EnemyBubble.cs         | Missile 追踪、Ghost 碎裂  |          1.5          |
|   P2   | Mask C 冷却副作用 |        PlayerState.cs         |    CD 期间受击伤害翻倍    |          0.5          |
|   P2   |     音效系统      |      （挂载到对应脚本）       |  打字声、发送声、技能声   |           1           |
|   P2   |  撤回消息收集品   | ItemPickup.cs、GameManager.cs |  记录数量、解锁隐藏剧情   |          0.5          |
|   P2   | 关卡后期全局增速  |      CameraController.cs      |    速度阈值 + 20%-30%     |          0.5          |

## 四、核心脚本清单与作用

### 1. Player 模块

|     脚本名称     |  挂载对象  |                    核心作用                     |                           关键逻辑                           |
| :--------------: | :--------: | :---------------------------------------------: | :----------------------------------------------------------: |
| PlayerController | 玩家预制体 | 处理角色移动、跳跃物理，检测与气泡 / 道具的碰撞 | - Rigidbody2D 控制水平移动 / 跳跃力；- OnCollisionEnter/Exit 检测气泡交互 |
|   MaskManager    | 玩家预制体 |    管理 Mask A/B/C 的触发、冷却、消耗 / 回复    | - Mask A：Queue 限制数量；- Mask B：计时器冷却；- Mask C：切换碰撞层 |
|   PlayerState    | 玩家预制体 |         管理快乐值、安全位置、受击逻辑          | - Mathf.Clamp 限制快乐值 0-100；- 每帧记录无碰撞的安全位置；- 受击伤害计算（含 Mask C CD 翻倍） |

### 2. Camera 模块

|     脚本名称     | 挂载对象 |                 核心作用                 |                           关键逻辑                           |
| :--------------: | :------: | :--------------------------------------: | :----------------------------------------------------------: |
| CameraController | 主摄像头 | 动态调速、区域判定、平滑插值、预生成适配 | - 三等分区域检测玩家位置；- Mathf.Lerp 实现 0.2 秒调速；- 速度适配预生成预警距离 |

### 3. Bubble 模块

|    脚本名称     |    挂载对象    |                        核心作用                         |                           关键逻辑                           |
| :-------------: | :------------: | :-----------------------------------------------------: | :----------------------------------------------------------: |
| BubbleGenerator | 空物体（全局） |         管理气泡生成、显隐、预生成、防空窗兜底          | - 激活线上方隐藏生成；- 触线恢复渲染 + 微动画；- 预警距离不足时预生成 |
|   SelfBubble    | 玩家气泡预制体 |      管理 Mask A/B 的物理属性、生命周期、渲染层级       | - Mask A：高摩擦、悬停；- Mask B：低摩擦、高弹性；- sortingOrder=20 置顶 |
|   EnemyBubble   | 敌对气泡预制体 | 管理不同类型敌对气泡的行为（下落 / 追踪 / 碎裂 / 扣血） | - Block：垂直下落；- Trap：触碰扣血；- Missile：追踪玩家；- Ghost：计时碎裂 |

### 4. Item 模块

|  脚本名称   |    挂载对象    |                 核心作用                  |                           关键逻辑                           |
| :---------: | :------------: | :---------------------------------------: | :----------------------------------------------------------: |
| ItemManager | 空物体（全局） |    管理所有道具 Buff 的状态、持续时间     | - 协程控制 Buff 时长；- 标记 Buff 激活状态（如 isCoffeeActive） |
| ItemPickup  |   道具预制体   | 检测玩家拾取、触发对应 Buff、播放拾取反馈 | - OnTriggerEnter 检测玩家；- 调用 ItemManager 触发 Buff；- 拾取后销毁 / 失活 |

### 5. UI 模块

|  脚本名称  |  挂载对象  |                      核心作用                      |                           关键逻辑                           |
| :--------: | :--------: | :------------------------------------------------: | :----------------------------------------------------------: |
| UIManager  |   Canvas   | 管理快乐值条、限制槽、通关 / 死亡 UI、聊天界面布局 | - 同步快乐值数值到 UI 滑块；- 显示 Mask A 剩余数量；- 触发通关 [发送] 按钮 UI |
| UIFeedback | 气泡预制体 | 处理气泡弹出动画、技能触发反馈（如 Mask C 半透明） |       - 0.1 秒微放大动画；- Mask C 激活时主角变半透明        |

### 6. Core 模块

|   脚本名称    |    挂载对象    |                       核心作用                        |                           关键逻辑                           |
| :-----------: | :------------: | :---------------------------------------------------: | :----------------------------------------------------------: |
|  GameManager  | 空物体（全局） | 管理全局流程（关卡切换、通关 / 死亡判定、收集品统计） | - 检测 [发送] 按钮触发；- 切换场景（主菜单→Level1→Level2）；- 死亡后加载 GameOver 场景 |
|  ObjectPool   | 空物体（全局） |        管理气泡对象池，复用预制体避免性能卡顿         | - 初始化气泡池；- 取对象（Get）、回对象（Return）；- 限制池大小 |
| BugFixHandler |   玩家预制体   |            修复 Mask C 卡墙、气泡重叠问题             | - Mask C 关闭前检测重叠，推离敌对气泡；- 极端情况瞬移到安全位置；- 玩家气泡覆盖敌对气泡碰撞 |

## 五、Git Ignore 配置（适配 Unity+GGJ）

```gitignore
# Unity默认忽略
Library/
Temp/
Obj/
Build/
Builds/
Logs/
UserSettings/
Library/
Assets/AssetStoreTools*
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd
*.pdb
*.mdb
*.opendb
*.VC.db

# 编辑器配置
.vs/
.vscode/
*.code-workspace
.idea/
*.iml
*.ipr
*.iws

# 系统文件
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db
desktop.ini

# GGJ临时文件
*.zip
*.7z
*.rar
Debug/
Release/
Builds/
# 避免提交大资源（可选，根据团队存储调整）
Assets/Resources/Audio/*.wav
Assets/Resources/Sprites/*.psd

# 自定义忽略（如测试场景/临时脚本）
Assets/Scenes/Test*.unity
Assets/Scripts/Test*.cs
```

## 六、开发注意事项

1. 引擎版本：确认 Unity 版本（修正 1.6.5 的笔误），推荐使用 LTS 版，避免兼容性问题；
2. 物理层规划：提前划分 Layer（Player/SelfBubble/EnemyBubble/UI/Item），简化碰撞矩阵管理；
3. 调试工具：在 GameManager 中添加调试开关（如显示摄像头区域、气泡激活线），加快问题定位；
4. GGJ 节奏：优先完成 P0 功能，确保核心玩法可玩，P1/P2 根据剩余时间迭代；
5. 代码规范：变量名 / 方法名统一（如驼峰命名），关键逻辑加注释，便于团队协作。